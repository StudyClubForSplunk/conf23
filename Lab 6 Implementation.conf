Started 2:32pm April 24th 2021 
#############################################
[clustering] pass4SymmKey = splunkisawesome
[indexer_discovery] pass4SymmKey = splunkisawesome1
#############################################

MC1:		3.85.241.175
CM1: 		3.235.25.250
IDX1:		3.93.74.21
IDX2:		3.235.30.24
SH1:		18.207.160.109
SSH User:	sccStudent
Splk User:	splunk
Password:	Im0Cd5Ye
Indexers:	3.93.74.21:9997,3.235.30.24:9997
CM URI:		https://3.235.25.250:8089
MC URI:		3.85.241.175:8089

#Tune all Splunk instances
#copy tune_splunk.sh to all instances
sudo bash ~/tune_splunk.sh -d true;source /home/sccStudent/.bash_profile;echo $SPLUNK_HOME;sudo cat /etc/tuned/splunk_idx/tuned.conf

#check if thp are disabled
| rest /services/server/sysinfo | fields splunk_server transparent_hugepages.defrag transparent_hugepages.effective_state transparent_hugepages.enabled
sudo $SPLUNK_HOME/bin/splunk -uri https://127.0.0.1:8089 -search "| rest /services/server/sysinfo | fields splunk_server transparent_hugepages.defrag transparent_hugepages.effective_state transparent_hugepages.enabled"

# Add all existing instances as search peers for mc
#sh1
sudo $SPLUNK_HOME/bin/splunk add search-server https://18.207.160.109:8089 -auth admin:Im0Cd5Ye -remoteUsername admin -remotePassword Im0Cd5Ye
#idx1
sudo $SPLUNK_HOME/bin/splunk add search-server https://3.93.74.21:8089 -auth admin:Im0Cd5Ye -remoteUsername admin -remotePassword Im0Cd5Ye
#idx2
sudo $SPLUNK_HOME/bin/splunk add search-server https://3.235.30.24:8089 -auth admin:Im0Cd5Ye -remoteUsername admin -remotePassword Im0Cd5Ye

# Black list the cm in the all_hosts serverclass on mc *cm1*

#get Splunk version
sudo $SPLUNK_HOME/bin/splunk -version
Splunk 8.1.0 (build f57c09e87251)


# Deploy Splunk Enterprise to cm1
sudo bash deploy_splunk_enterprise.sh -p /opt -h cfrtl5-cclabs516921-cm1.class.splunk.com -v 8.1.0 -b f57c09e87251

# Add cm1 instances as search peers for mc
# MC1 SSH Session
sudo $SPLUNK_HOME/bin/splunk add search-server https://3.235.25.250:8089 -auth admin:Im0Cd5Ye -remoteUsername admin -remotePassword Im0Cd5Ye

# Select splunk base apps
# Select replication_factor given there are two indexer nodes available:> 2
splunk_base_apps\cluster-manager\org_cluster_master_base\local\outputs.conf
splunk_base_apps\cluster-manager\org_master_deploymentclient\local\deploymentclient.conf
splunk_base_apps\monitoring-console\org_all_mc_base\local\outputs.conf
splunk_base_apps\searchheads\org_all_search_base\local\outputs.conf
splunk_base_apps\searchheads\org_all_search_base\local\server.conf
splunk_base_apps\search-peers\cfrt_all_indexes\local\indexes.conf
splunk_base_apps\search-peers\org_cluster_indexer_base\local\server.conf

# Copy apps to CM apps folder
sudo cp -Rf /home/sccStudent/org_cluster_master_base $SPLUNK_HOME/etc/apps;sudo chown -R splunk:splunk $SPLUNK_HOME/etc/apps/org_cluster_master_base
sudo cp -Rf /home/sccStudent/org_master_deploymentclient $SPLUNK_HOME/etc/apps;sudo chown -R splunk:splunk $SPLUNK_HOME/etc/apps/org_master_deploymentclient
sudo cat $SPLUNK_HOME/etc/apps/org_master_deploymentclient/local/deploymentclient.conf
sudo $SPLUNK_HOME/bin/splunk restart

#check permissions
sudo ls -l $SPLUNK_HOME/etc/apps
sudo ls -l $SPLUNK_HOME/etc/master-apps

#check deployed apps
sudo $SPLUNK_HOME/bin/splunk display app

# Copy base apps to indexer apps to DS on MC1
sudo cp -Rf /home/sccStudent/search-peers/cfrt_all_edifecs_props $SPLUNK_HOME/etc/deployment-apps;sudo chown -R splunk:splunk $SPLUNK_HOME/etc/deployment-apps/cfrt_all_edifecs_props;
sudo cp -Rf /home/sccStudent/search-peers/cfrt_all_iis_onboarding_props $SPLUNK_HOME/etc/deployment-apps;sudo chown -R splunk:splunk $SPLUNK_HOME/etc/deployment-apps/cfrt_all_iis_onboarding_props;
sudo cp -Rf /home/sccStudent/search-peers/cfrt_all_indexes $SPLUNK_HOME/etc/deployment-apps;sudo chown -R splunk:splunk $SPLUNK_HOME/etc/deployment-apps/cfrt_all_indexes;
sudo cp -Rf /home/sccStudent/search-peers/cfrt_all_s2s-9997_inputs $SPLUNK_HOME/etc/deployment-apps;sudo chown -R splunk:splunk $SPLUNK_HOME/etc/deployment-apps/cfrt_all_s2s-9997_inputs;
sudo cp -Rf /home/sccStudent/search-peers/cfrt_all_sshd_syslog_props $SPLUNK_HOME/etc/deployment-apps;sudo chown -R splunk:splunk $SPLUNK_HOME/etc/deployment-apps/cfrt_all_sshd_syslog_props;
sudo cp -Rf /home/sccStudent/search-peers/cfrt_all_volume-iops_props  $SPLUNK_HOME/etc/deployment-apps;sudo chown -R splunk:splunk $SPLUNK_HOME/etc/deployment-apps/cfrt_all_volume-iops_props;
sudo cp -Rf /home/sccStudent/search-peers/cfrt_full_license_server $SPLUNK_HOME/etc/deployment-apps;sudo chown -R splunk:splunk $SPLUNK_HOME/etc/deployment-apps/cfrt_full_license_server;
sudo cp -Rf /home/sccStudent/search-peers/cfrt_indexer_disable-ui_web  $SPLUNK_HOME/etc/deployment-apps;sudo chown -R splunk:splunk $SPLUNK_HOME/etc/deployment-apps/cfrt_indexer_disable-ui_web;
sudo cp -Rf /home/sccStudent/search-peers/cfrt_indexer_volume_indexes $SPLUNK_HOME/etc/deployment-apps;sudo chown -R splunk:splunk $SPLUNK_HOME/etc/deployment-apps/cfrt_indexer_volume_indexes;
sudo ls -l $SPLUNK_HOME/etc/deployment-apps
NOT org_cluster_indexer_base
NOT cfrt_all_deploymentclient
NOT cfrt_all_forwarder_outputs
#check one of the settings
sudo cat $SPLUNK_HOME/etc/deployment-apps/org_cluster_indexer_base/local/server.conf
sudo cat $SPLUNK_HOME/etc/deployment-apps/org_cluster_indexer_base/local/outputs.conf
sudo ls -l $SPLUNK_HOME/etc/master-apps/org_cluster_indexer_base
sudo $SPLUNK_HOME/bin/splunk reload deploy-server

# Log on to DS (mc1)
#create serverclass "cluster_master_class"
#ad apps #these are empty#
#sudo tar -zcvf ~/existing_apps.tgz $SPLUNK_HOME/etc/deployment-apps
cfrt_all_edifecs_props 	
cfrt_all_iis_onboarding_props 	
cfrt_all_indexes 	
cfrt_all_s2s-9997_inputs 	
cfrt_all_sshd_syslog_props 	
cfrt_all_volume-iops_props 	
cfrt_full_license_server 	
cfrt_indexer_disable-ui_web 	
cfrt_indexer_volume_indexes
#add clients
whitelist *cm1*

#check app have been deployed to CM
sudo ls -l $SPLUNK_HOME/etc/master-apps/cfrt_all_indexes 
sudo cat $SPLUNK_HOME/etc/master-apps/cfrt_all_indexes/local/indexes.conf

#check apps on standalone indexers
sudo ls -l $SPLUNK_HOME/etc/apps

#remove deployment client app from cm it it was already copied there from mc1
sudo rm -rf $SPLUNK_HOME/etc/master-apps/cfrt_all_deploymentclient
sudo $SPLUNK_HOME/bin/splunk restart

#edit serverclass.conf
sudo vi $SPLUNK_HOME/etc/system/local/serverclass.conf

#Remove the indexers from the Deployment Server
#idx1
sudo $SPLUNK_HOME/bin/splunk stop
sudo ls -l $SPLUNK_HOME/etc/apps/
sudo $SPLUNK_HOME/bin/splunk btool deploymentclient list --debug 
sudo cat $SPLUNK_HOME/etc/apps/cfrtl5_all_deploymentclient/local/deploymentclient.conf
sudo rm -rf $SPLUNK_HOME/etc/apps/cfrt_all_deploymentclient;sudo rm -rf $SPLUNK_HOME/etc/apps/cfrtl5_all_deploymentclient
sudo $SPLUNK_HOME/bin/splunk start

#idx2
sudo $SPLUNK_HOME/bin/splunk stop
sudo ls -l $SPLUNK_HOME/etc/apps/
sudo $SPLUNK_HOME/bin/splunk btool deploymentclient list --debug 
sudo rm -rf $SPLUNK_HOME/etc/apps/cfrt_all_deploymentclient;sudo rm -rf $SPLUNK_HOME/etc/apps/cfrtl5_all_deploymentclient
sudo $SPLUNK_HOME/bin/splunk start

#check indexes.conf on idx1
#sudo $SPLUNK_HOME/bin/splunk btool indexes list --debug | grep onboarding

#sudo cat $SPLUNK_HOME/etc/system/local/indexes.conf  
#sudo cat $SPLUNK_HOME/etc/system/default/indexes.conf > ~/idx1_indexes.conf
#launcher app owns onboarding index
#sudo cat $SPLUNK_HOME/etc/apps/launcher/local/indexes.conf  > ~/idx1_laucher_indexes.conf
#sudo vi $SPLUNK_HOME/etc/apps/launcher/local/indexes.conf
#indexes.conf need to move to a base app

#sh1 check deployment client
#sudo cat $SPLUNK_HOME/etc/apps/cfrt_all_deploymentclient/local/deploymentclient.conf
#sudo cat $SPLUNK_HOME/etc/apps/cfrtl5_all_deploymentclient/local/deploymentclient.conf

# Join indexers to Cluster Master

#check app have been deployed to CM
sudo cat $SPLUNK_HOME/etc/master-apps/org_cluster_indexer_base/local/server.conf
sudo ls -l $SPLUNK_HOME/etc/master-apps/cfrt_all_indexes 
sudo cat $SPLUNK_HOME/etc/master-apps/cfrt_all_indexes/local/indexes.conf
sudo cat $SPLUNK_HOME/etc/deployment-apps/cfrt_all_indexes/local/indexes.conf
sudo cat $SPLUNK_HOME/etc/deployment-apps/cfrt_all_indexes/local/indexes.conf
sudo cat ~/indexer/cfrt_all_indexes/local/indexes.conf

#make sure there is just the base deployment client app
sudo ls -l $SPLUNK_HOME/etc/apps

# idx2
sudo $SPLUNK_HOME/bin/splunk stop
sudo cp -Rf /home/sccStudent/org_cluster_indexer_base $SPLUNK_HOME/etc/apps;sudo chown -R splunk:splunk $SPLUNK_HOME/etc/apps/org_cluster_indexer_base
sudo cat $SPLUNK_HOME/etc/apps/org_cluster_indexer_base/local/server.conf
sudo $SPLUNK_HOME/bin/splunk btool server list --debug | grep pass4SymmKey > ~/idx2_before_join_cluster.conf
sudo $SPLUNK_HOME/bin/splunk restart
sudo $SPLUNK_HOME/bin/splunk btool server list --debug | grep pass4SymmKey > ~/idx2_after_join_cluster.conf

# idx1
sudo $SPLUNK_HOME/bin/splunk stop
sudo cp -Rf /home/sccStudent/org_cluster_indexer_base $SPLUNK_HOME/etc/apps;sudo chown -R splunk:splunk $SPLUNK_HOME/etc/apps/org_cluster_indexer_base
sudo cat $SPLUNK_HOME/etc/apps/org_cluster_indexer_base/local/server.conf
sudo $SPLUNK_HOME/bin/splunk btool server list --debug | grep pass4SymmKey > ~/idx1_before_join_cluster.conf
sudo $SPLUNK_HOME/bin/splunk restart
sudo $SPLUNK_HOME/bin/splunk btool server list --debug | grep pass4SymmKey > ~/idx1_after_join_cluster.conf

#examine idx folders
sudo ls -l $SPLUNK_HOME/etc/slave-apps
#############################################################
YES but permission is root on idx1 and idx2
#############################################################

# Push configuration bundle on CM1
https://cfrtl5-cclabs516921-cm1.class.splunk.com:8000/en-GB/manager/system/clustering_push#

# Join SH1 to Cluster Master
# check if SH1 is a deployment client
sudo $SPLUNK_HOME/bin/splunk btool deploymentclient list --debug 
YES of the DS named MC1

There is a server class named all_search that sends the following apps
cfrt_all_edifecs_props 	
cfrt_all_forwarder_outputs 	
cfrt_all_iis_onboarding_props 	
cfrt_all_indexes 	
cfrt_all_sshd_syslog_props 	
cfrt_all_volume-iops_props
NO clients are added yet


sudo $SPLUNK_HOME/bin/splunk stop
sudo cp -Rf /home/sccStudent/org_all_search_base $SPLUNK_HOME/etc/apps;sudo chown -R splunk:splunk $SPLUNK_HOME/etc/apps/org_all_search_base
sudo cat $SPLUNK_HOME/etc/apps/org_all_search_base/local/server.conf
sudo $SPLUNK_HOME/bin/splunk btool server list --debug | grep pass4SymmKey > ~/sh1_before_join_cluster.conf
sudo $SPLUNK_HOME/bin/splunk restart
sudo $SPLUNK_HOME/bin/splunk btool server list --debug | grep pass4SymmKey > ~/sh1_after_join_cluster.conf

#send MC logs to index cluster
# Copy apps to MC apps folder
sudo $SPLUNK_HOME/bin/splunk stop
sudo cp -Rf /home/sccStudent/org_all_mc_base $SPLUNK_HOME/etc/apps;sudo chown -R splunk:splunk $SPLUNK_HOME/etc/apps/org_all_mc_base;
sudo $SPLUNK_HOME/bin/splunk start


Migrate buckets from a non-clustered environment into the Indexer Cluster

#idx1
sudo ls -l $SPLUNK_DB/onboarding/db
sudo ls $SPLUNK_DB/onboarding/db
CreationTime  db_1423353933_1348712853_10  db_1431292691_1423688984_11  db_1438807630_1431541724_12  GlobalMetaData

Identify GUID of the single instance
sudo cat $SPLUNK_HOME/etc/instance.cfg
-----------------------------------------------------------
[general]
guid = 53A14D88-51FA-42FC-82B7-A90836243088
-----------------------------------------------------------

#Rebalance buckets
For each directory in the homePath of the onboarding index, rename the directory to append an

#STOP SPLUNK
sudo $SPLUNK_HOME/bin/splunk stop
sudo mv $SPLUNK_DB/onboarding/db/db_1423353933_1348712853_10 $SPLUNK_DB/onboarding/db/db_1423353933_1348712853_10_53A14D88-51FA-42FC-82B7-A90836243088
sudo mv $SPLUNK_DB/onboarding/db/db_1431292691_1423688984_11 $SPLUNK_DB/onboarding/db/db_1431292691_1423688984_11_53A14D88-51FA-42FC-82B7-A90836243088
sudo mv $SPLUNK_DB/onboarding/db/db_1438807630_1431541724_12 $SPLUNK_DB/onboarding/db/db_1438807630_1431541724_12_53A14D88-51FA-42FC-82B7-A90836243088
sudo $SPLUNK_HOME/bin/splunk start

# On MC1 Switch Mode to Distributed
#remove indexer role from MC1


#############################################
######### Troubleshooting ###################
#############################################

https://docs.splunk.com/Documentation/Splunk/8.1.3/Indexer/Configurethepeerindexes
When you first create the cluster, the manager node distributes a special default indexes.conf file to each of the peers. 
This version supplements the standard default indexes.conf that all indexers get. 
The peer-specific default indexes.conf turns on replication for the main index, as well as the internal indexes, such as _audit and _internal. 

[idx1]
repFactor = auto
homePath = $SPLUNK_DB/$_index_name/db
coldPath = $SPLUNK_DB/$_index_name/colddb
thawedPath = <path for thawed buckets>

#############################################
Linux kernel transparent huge pages
One or more Splunk instances are running on a host that has kernel transparent huge pages enabled. This can significantly reduce performance and is against best practice.

Suggested Action
Turn off kernel transparent huge pages.

https://community.splunk.com/t5/Monitoring-Splunk/How-do-I-disable-Transparent-Huge-Pages-THP-and-confirm-that-it/td-p/124490


#############################################


#############################################
Assessment of server ulimits
Description

This checks whether the machine is provisioned with ulimit settings (file descriptors, user processes, and data segment size) that are adequate for running Splunk software.
Message

One or more Splunk instances are running on a host that has one or more resource limits set below official recommendations.
Suggested Action

Persistently modify resource limits per documented best practices.
https://docs.splunk.com/Documentation/Splunk/8.1.0/Installation/Systemrequirements?ref=hk#Considerations_regarding_system-wide_resource_limits_on_.2Anix_systems
https://community.splunk.com/t5/Deployment-Architecture/Why-are-my-ulimits-settings-not-being-respected-on-ubuntu-debian/td-p/195428

| rest splunk_server_group=* /services/server/info 
| join type=outer splunk_server [rest splunk_server_group=* /services/server/sysinfo | fields splunk_server ulimits.data_segment_size ulimits.open_files ulimits.user_processes] 
| eval ulimits.data_segment_size = if(isnotnull('ulimits.data_segment_size'), 'ulimits.data_segment_size', "unavailable") 
| eval ulimits.open_files = if(isnotnull('ulimits.open_files'), 'ulimits.open_files', "unavailable") 
| eval ulimits.user_processes = if(isnotnull('ulimits.user_processes'), 'ulimits.user_processes', "unavailable") 
| eval sev_segment_size = case('ulimits.data_segment_size' == -1 OR 'ulimits.data_segment_size' >= 1073741824, 0, 'ulimits.data_segment_size' == "unavailable", -1, True(), 2) 
| eval sev_open_files = case('ulimits.open_files' == -1 OR 'ulimits.open_files' >= 64000, 0, 'ulimits.open_files' == "unavailable", -1, True(), 2) 
| eval sev_user_processes = case('ulimits.user_processes' == -1 OR 'ulimits.user_processes' >= 16000, 0, 'ulimits.user_processes' == "unavailable", -1, True(), 2) 
| eval severity_level = max(sev_segment_size, sev_open_files, sev_user_processes) 
| fields splunk_server ulimits.data_segment_size ulimits.open_files ulimits.user_processes severity_level 
| rename splunk_server AS instance ulimits.data_segment_size AS "ulimits.data_segment_size (current / recommended)" ulimits.open_files AS "ulimits.open_files (current / recommended)" ulimits.user_processes AS "ulimits.user_processes (current / recommended)" 
| fieldformat ulimits.data_segment_size (current / recommended) = (if('ulimits.data_segment_size (current / recommended)' >= 0, 'ulimits.data_segment_size (current / recommended)', 'ulimits.data_segment_size (current / recommended)'))." / 1073741824" 
| fieldformat ulimits.open_files (current / recommended) = (if('ulimits.open_files (current / recommended)' >= 0, 'ulimits.open_files (current / recommended)', 'ulimits.open_files (current / recommended)'))." / 64000" 
| fieldformat ulimits.user_processes (current / recommended) = (if('ulimits.user_processes (current / recommended)' >= 0, 'ulimits.user_processes (current / recommended)', 'ulimits.user_processes (current / recommended)'))." / 16000" 
| fields - _timediff
											ulimits.data_segment_size 	ulimits.open_files 			ulimits.user_processes
											(current / recommended) 	(current / recommended) 	(current / recommended) 
cfrtl5-cclabs516921-idx1.class.splunk.com	-1 / 1073741824				4096 / 64000				7025 / 16000	
cfrtl5-cclabs516921-idx2.class.splunk.com	-1 / 1073741824				4096 / 64000				7025 / 16000	
cfrtl5-cclabs516921-sh1.class.splunk.com	-1 / 1073741824				4096 / 64000				7025 / 16000	
cfrtl5-cclabs516921-cm1.class.splunk.com	-1 / 1073741824				4096 / 64000				7025 / 16000	
cfrtl5-cclabs516921-mc1.class.splunk.com	-1 / 1073741824				4096 / 64000				7025 / 16000	

ulimit -a
# if you are running splunk under another user
su splunk ulimit -a
# or restart splunk and check
grep ulimit $SPLUNK_HOME/var/log/splunk/splunkd.log

ulimit -n 64000

Open files 			ulimit -n 	64000
User processes 		ulimit -u 	16000
Data segment size 	ulimit -d 	The maximum RAM you want Splunk Enterprise to allocate in kilobytes. For example, 8GB is 8000000.
File size 			ulimit -f 	-1 A setting of -1 sets the file size to unlimited. 

SPLUNK_HOME=/opt/splunk;sudo $SPLUNK_HOME/bin/splunk status
#############################################


#############################################################################################################
Local indexing on non-indexer instances
Description

This checks whether any non-indexer instances (search heads, indexer cluster master nodes, license masters, deployment servers, search head cluster deployers) are indexing their own events locally, instead of forwarding the data to the indexers, per best practices.
Message

One or more non-indexer instances is not forwarding their events to the indexers. This can isolate some of your data and prevent some Monitoring Console dashboards from working.
Suggested Action

Make sure that all non-indexer instances are forwarding their internal events to the indexers, per best practices.

| rest splunk_server_group=* /services/server/info 
| fields splunk_server isForwarding server_roles 
| where (server_roles=="search_head" OR server_roles=="cluster_master" OR server_roles=="license_master" OR server_roles=="shc_deployer" OR server_roles=="deployment_server" OR isNull(server_roles)) 
| eval severity_level = case( isForwarding==1, 0, isForwarding == 0, 2, true(), -1) 
| rename splunk_server AS instance
idx1 and idx2

#############################################################################################################
remove sh role from sh
remove idx from cm
remove idx from mc

log forwarding
index=_internal splunk_server_group=dmc_group_indexer earliest=-15m | stats count as a by host | stats dc(host) as b | eval severity_level = if(b = 5, 0, 3) | fields host severity_level

cm & mc
sudo ls -l /home/sccStudent/outputs.conf $SPLUNK_HOME/etc/system/local
sudo cp -Rf /home/sccStudent/outputs.conf $SPLUNK_HOME/etc/system/local;sudo chown -R splunk:splunk $SPLUNK_HOME/etc/system/local/outputs.conf;sudo $SPLUNK_HOME/bin/splunk restart






Troubleshooting
	Wrong number of search peers connected to cluster master
		Check that both indexers have been connected to the cluster
		| rest splunk_server=local splunk_server_group=dmc_group_cluster_master /services/cluster/master/peers | stats count as NumberOfSearchPeers | eval severity_level=if( NumberOfSearchPeers=2,0,3 )


	The cluster does not contain two search peers
		Check that both indexers are connected to the cluster master
		| rest splunk_server=local splunk_server_group=dmc_group_cluster_master /services/cluster/master/peers | fields label | stats count | eval severity_level = if(count=2,0,3)

	A search head is not connected to the cluster master
		Connect sh1 to the cluster master
		| rest splunk_server=local splunk_server_group=dmc_group_cluster_master /services/cluster/master/searchheads | search label=*sh1* | stats count as LabeledSearchHeads | eval severity_level = if(LabeledSearchHeads=1, 0, 3)
		
		
	Some hosts internal logs cannot be seen, check that all non-indexer hosts are forwarding to the indexing tier
		Check that all non-indexer instances are forwarding to the indexing tie
		add outputs.conf sh1,mc1 and cm1
		index=_internal splunk_server_group=dmc_group_indexer earliest=-15m | stats count as a by host | stats dc(host) as b | eval severity_level = if(b = 5, 0, 3) | fields host severity_level
		
		#####Search filters specified using splunk_server/splunk_server_group do not match any search peer.#####
	
	Incorrectly assigned servers
	| rest splunk_server_group=dmc_group_search_head /services/server/info | fields splunk_server | search splunk_server="*-sh1*" | stats count | eval severity_level = if(count==1,0,3)
		remove indexer role from mc1  
		remove indexer role from sh1 
		remove search roles from cm
		remove indexer roles from cm
	
	The deployment server has no cluster master client (named *cm1*)
	| rest splunk_server=local splunk_server_group=dmc_group_deployment_server /services/deployment/server/clients | fields hostname | search hostname=*cm1* | stats count values(hostname) as hostnames | eval severity_level = if(count==1,0,3) | fields - count
		fixed by editing whitelisting entry
	
	Wrong number of buckets in the onboarding index
	| rest splunk_server=local splunk_server_group=dmc_group_indexer /services/cluster/slave/buckets | search index=onboarding | stats count | eval severity_level = if(count == 6, 0, 3)
		Check that replication factor has been set to 2 and that the cluster is operating as expected
		onboarding index is on idx1 but not idx2
	
use Configuration Bundle Actions for search peers
	
#check if apps have been deployed to indexers
sudo ls -l $SPLUNK_HOME/etc/slave-apps

#check if apps have been deployed to cm for indexers
sudo ls -l $SPLUNK_HOME/etc/master-apps

sudo $SPLUNK_HOME/bin/splunk show listen

sudo $SPLUNK_HOME\bin\splunk list licenser-slaves

check if all appas have been sent to indexers
on idx1
sudo ls -l $SPLUNK_HOME/etc/slave-apps/org_cluster_indexer_base/local
sudo ls -l $SPLUNK_HOME/etc/master-apps/org_cluster_indexer_base/local
sudo cat $SPLUNK_HOME/etc/master-apps/org_cluster_indexer_base/local/inputs.conf

sudo $SPLUNK_HOME/bin/splunk btool input list --debug
sudo $SPLUNK_HOME/bin/splunk btool output list --debug
sudo $SPLUNK_HOME/bin/splunk btool server list --debug | grep clustering
sudo $SPLUNK_HOME/bin/splunk btool indexes list --debug | grep repFactor
sudo $SPLUNK_HOME/bin/splunk btool deploymentclient list

#kill firewall and restart all instances
sudo systemctl stop firewalld;sudo systemctl disable firewalld
sudo $SPLUNK_HOME/bin/splunk restart

Ideas
check permissions of indexing folders
