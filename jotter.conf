### Other thoughts / talking points
Disable WebUI on Indexers
Enable WebUI on SH, DS

forward _* internal logs to the indexers
enable cooked Splunk port 9997 inputs on the indexers
Apply Licence
```
/opt/splunk/bin/splunk edit licenser-localpeer -manager_uri 'https://deploymentserver.yourdomain.com:8089'
/opt/splunk/bin/splunk restart
/opt/splunk/bin/splunk list licenser-localpeer
```
Add deployment client
```
vi /opt/splunk/etc/system/local/deploymentclient.conf
```
```
[deployment-client]
[target-broker:deploymentServer]
targetUri = https://deploymentserver.yourdomain.com:8089
```
School of thought: start Splunk as root first, then stop, chown, set boot and run as splunk user
chmod v chown 
sudo /opt/splunk/bin/splunk stop
sudo rm -rf /opt/splunk

sudo ls -las /etc/systemd/system/
sudo cat /etc/systemd/system/Splunkd.service

sudo -f tail /opt/splunk-3/splunk/var/log/splunk/splunkd.log
sudo cat /opt/splunk-3/splunk/var/log/splunk/splunkd.log




Authentication is required to start 'Splunkd.service'.
Authenticating as: Ubuntu (ubuntu)
Password: Failed to start Splunkd.service: Connection timed out

sudo cat /etc/sudoers

splunk ALL=(root) NOPASSWD: /usr/bin/systemctl restart Splunkd.service
splunk ALL=(root) NOPASSWD: /usr/bin/systemctl stop Splunkd.service
splunk ALL=(root) NOPASSWD: /usr/bin/systemctl start Splunkd.service
splunk ALL=(root) NOPASSWD: /usr/bin/systemctl status Splunkd.service
splunk ALL=(root) NOPASSWD: /usr/bin/systemctl restart Splunkd
splunk ALL=(root) NOPASSWD: /usr/bin/systemctl stop Splunkd
splunk ALL=(root) NOPASSWD: /usr/bin/systemctl start Splunkd
splunk ALL=(root) NOPASSWD: /usr/bin/systemctl status Splunkd
splunk ALL=(root) NOPASSWD: /opt/splunk/bin/splunk restart
splunk ALL=(root) NOPASSWD: /opt/splunk/bin/splunk stop
splunk ALL=(root) NOPASSWD: /opt/splunk/bin/splunk start
splunk ALL=(root) NOPASSWD: /opt/splunk/bin/splunk status

cp /tmp/palo_endpoint.log /studyclubforsplunk

sudo chown -R root /studyclubforsplunk


sudo chmod o-r /studyclubforsplunk/palo_endpoint.log

setfacl is short for set File ACL (Access Control List)
sudo setfacl -m u:splunk:rwx /studyclubforsplunk


sudo setfacl -m user:splunk:+r /studyclubforsplunk/palo_endpoint.log

sudo setfacl -Rm g:splunk:rX,d:g:splunk:rX /studyclubforsplunk

cat palo_endpoint.log

Splunk Tutorial Data
https://docs.splunk.com/Documentation/Splunk/latest/SearchTutorial/GetthetutorialdataintoSplunk

sudo setfacl -m user:splunk:-r /studyclubforsplunk

sudo chmod -rwx /studyclubforsplunk
sudo chmod 755 /studyclubforsplunk


sudo setfacl -b -R /studyclubforsplunk

sudo chown root:root /studyclubforsplunk:

sudo chmod 700 /studyclubforsplunk



rm -rf /studyclubforsplunk


mkdir /studyclubforsplunk
cd /
sudo cp -R /tmp/logs/* /studyclubforsplunk/
sudo ls -las /studyclubforsplunk

sudo setfacl -m user:splunk:+r /studyclubforsplunk/palo_endpoint.log
sudo setfacl -m user:splunk:r-X /studyclubforsplunk/

vi /opt/splunk/etc/apps/search/local/indexes.conf
[studyclub]
coldPath = $SPLUNK_DB/studyclub/colddb
enableDataIntegrityControl = 0
enableTsidxReduction = 0
homePath = $SPLUNK_DB/studyclub/db
maxTotalDataSizeMB = 512000
thawedPath = $SPLUNK_DB/studyclub/thaweddb
repFactor = auto


cp /opt/splunk-2/splunk/etc/master-apps/_cluster/default/indexes.conf /opt/splunk-2/splunk/etc/master-apps/_cluster/local
vi /opt/splunk-2/splunk/etc/master-apps/_cluster/local/indexes.conf

save
:x!

web.conf[settings]
enableSplunkWebSSL = 1
privKeyPath = /opt/splunk-1/splunk/etc/auth/splunkweb/mySplunkWebPrivateKey.key
caCertPath = /opt/splunk-1/splunk/etc/auth/splunkweb/mySplunkWebCert.pem

check and validate the bundle
/opt/splunk-2/splunk/bin/splunk validate cluster-bundle

 Push out bundle
/opt/splunk-2/splunk/bin/splunk apply cluster-bundle 

Check status of the pushed bundle
/opt/splunk-2/splunk/bin/splunk show cluster-bundle-status



## Testing and Planning phase only
### User localhost rather than IP in confguration

#### Determine IP address
```
homstname -I
```
#### ensure Splunk is not running
```
/opt/splunk/bin/splunk stop
```
#### Determine which port Splunk is using
```
sudo lsof -i -P -n | grep LISTEN | grep splunkd
```
#### Check replication port 
#### [replication_port://****]
```
cat /opt/splunk-1/splunk/etc/system/local/server.conf
```

## when attendee instances fire up we want Splunk to be running but there is no boot-start for init.d for any instances?? It worked fine when Linux instance was haded to us by SplunkShow
 
 ## Preference to use the fresh build for the SH rather than IDX-01. In case of any issues, the index will still work and we can use the CM for searching

startup script
netstat -tulpan

 journalctl -xe to see booting verbose

/opt/splunk-1/splunk/bin/splunk btool web list --debug | grep -v "system/default" | grep -v "rapid_diag" | grep -v "instrumentation" | grep -v "secure_gateway" | grep -v "upgrade_read" | grep -v "splunk_assist"


use btool to find props.conf file

/opt/splunk/bin/splunk btool props list --debug | grep pan:endpoint
cat  /opt/splunk/etc/apps/search/local/props.conf
use btool to find inputs.conf file

/opt/splunk/bin/splunk btool inputs list --debug | grep pan:endpoint
cat  /opt/splunk/etc/apps/search/local/inputs.conf



/opt/splunk/bin/splunk cmd btprobe -d /opt/splunk/var/lib/splunk/fishbucket/splunk_private_db/ --file /studyclubforsplunk/www2/access.log




[studyclub_secure]
coldPath = $SPLUNK_DB/studyclub_secure/colddb
enableDataIntegrityControl = 0
enableTsidxReduction = 0
homePath = $SPLUNK_DB/studyclub_secure/db
maxTotalDataSizeMB = 512000
thawedPath = $SPLUNK_DB/studyclub_secure/thaweddb
repFactor = auto
